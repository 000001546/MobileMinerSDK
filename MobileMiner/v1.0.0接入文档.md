## Waterhole手机挖矿v1.0.0 SDK文档
<br />
### SDK介绍

Waterhole手机挖矿SDK，目前提供了门罗币（Monero, 代号XMR）的挖矿支持。目前门罗币手机挖矿只支持64位的运行环境，支持的ABI为arm64-v8a。连接的矿池为Waterhole公司矿池，内置钱包地址为Waterhole公司门罗地址，第三方开源代码抽水为0%。

<br />
### 快速集成

#### 1. 在app主模块的build.gradle中添加挖矿aar引用
```
compile(name: 'miner-core-1.0.0', ext: 'aar')
compile(name: 'miner-xmr-1.0.0', ext: 'aar')

// 第三方依赖库
compile 'com.umeng.analytics:analytics:6.1.4'
```
<br />
#### 2. 在app主模块的build.gradle中设置NDK ABI参数
```
ndk {
       abiFilters "armeabi", "armeabi-v7a", "arm64-v8a", "x86", "mips"
    }
```

 注意：由于目前门罗算法在arm平台下，只支持64位，32位存在内存对齐问题。所以在gradle中设置abi，是为了app在运行时能够优先选择arm64-v8a。如果app内部使用了其他so库，则必须有对应的arm64-v8a目录，否则应用不会以64位的环境运行。如果有个别的库没有arm64-v8a包的话，则运行时，使用对应功能会crash。

<br />
#### 3. 权限
打开AndroidManifest.xml，添加组件需要的权限：

```
<uses-permission android:name="android.permission.INTERNET"/>
```
注意：SDK内部不做权限处理，交由接入方来处理。

<br />
#### 4. 混淆
在混淆文件中加入：

```
-keep public class waterhole.miner.core.NoProGuard
-keep class * implements waterhole.miner.core.NoProGuard {*;}

-dontwarn com.umeng.**
-keep public interface com.umeng.socialize.**
-keep public interface com.umeng.socialize.sensor.**
-keep public interface com.umeng.scrshot.**
```

<br />
#### 5. 接入代码

开始挖矿：

```
XmrMiner.instance().init(context)
		 .setStateObserver(new StateObserver(){})
		 .startMine(); 
```
    
停止挖矿：

```
XmrMiner.instance().stopMine(); 
```

是否正在挖矿：

```
XmrMiner.instance().isMining(); 
```


设置挖矿最大CPU温度（必须在startMine()函数之前调用，默认为65℃）：

```
XmrMiner.instance().setMaxTemperature(int)
```


获取当前CPU温度：

```
XmrMiner.instance().getCurrentTemperature()
```

<br />
#### 6. API说明

##### 6.1 class XmrMiner

###### instance()

<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>CommonMinerInterface</td>
        <td>获取XmrMiner实例（单例）</td>
    </tr>
</table>

###### startMine()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>void</td>
        <td>开始挖矿，内部会开启一个独立进程进行挖矿</td>
    </tr>
</table>

###### stopMine()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>void</td>
        <td>停止挖矿，会杀掉挖矿进程，释放资源</td>
    </tr>
</table>

###### isMining()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>boolean</td>
        <td>是否正在挖矿中，true 是 | false 否</td>
    </tr>
</table>

###### init()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>context</td>
        <td>Context</td>
        <td>CommonMinerInterface</td>
        <td>初始化</td>
    </tr>
</table>

###### setStateObserver()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>stateObserver</td>
        <td>StateObserver</td>
        <td>CommonMinerInterface</td>
        <td>挖矿状态观察者回调</td>
    </tr>
</table>

###### setMaxTemperature()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>maxTemperature</td>
        <td>int</td>
        <td>CommonMinerInterface</td>
        <td>设置挖矿最大CPU温度，默认为65℃，必须在startMine()函数之前调用</td>
    </tr>
</table>

###### getCurrentTemperature()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>返回类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>int</td>
        <td>获取当前CPU温度</td>
    </tr>
</table>

<br />
##### 6.2 class StateObserver

###### onConnectPoolBegin()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>开始连接矿池回调</td>
    </tr>
</table>

###### onConnectPoolSuccess()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>无</td>
        <td>无</td>
        <td>连接矿池成功回调</td>
    </tr>
</table>

###### onConnectPoolFail()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>error</td>
        <td>String</td>
        <td>连接矿池失败回调，回调失败原因</td>
    </tr>
</table>

###### onPoolDisconnect()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>error</td>
        <td>String</td>
        <td>与矿池连接断开，回调失败原因</td>
    </tr>
</table>

###### onMessageFromPool()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>message</td>
        <td>String</td>
        <td>收到矿池信息回调</td>
    </tr>
</table>

###### onMiningError()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>error</td>
        <td>String</td>
        <td>挖矿错误回调，回调失败原因</td>
    </tr>
</table>

###### onMiningStatus()
<table>
    <tr>
        <td>参数名</td>
        <td>参数类型</td>
        <td>说明</td>
    </tr>
    <tr>
        <td>speed</td>
        <td>double</td>
        <td>挖矿速度，建议保留3-4位小数，门罗币的单位为H/s</td>
    </tr>
</table>

##### 6.2 class CommonMinerInterface
各个挖矿币的统一接口，接入方无需了解。

<br />
#### 7. 技术支持
```
qq: 651043704  
wechat: k651043704
```
